<!DOCTYPE html>
<html>

<head>
    <title>XP Progression Timeplot</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: white;
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .chart-container {
            position: relative;
            width: 50%;
        }

        svg {
            width: 100%;
            height: auto;
        }

        .trend-line {
            stroke: #4bc0c0;
            stroke-width: 2;
            fill: none;
        }

        .area-fill {
            fill: rgba(75, 192, 192, 0.1);
            stroke: none;
        }

        .data-point {
            fill: #4bc0c0;
            cursor: pointer;
            transition: r 0.2s;
        }

        .data-point:hover {
            r: 5;
        }

        .axis {
            stroke: #999;
            stroke-width: 1;
        }

        .tick {
            stroke: #e0e0e0;
            stroke-width: 1;
        }

        .tick-text {
            font-size: 10px;
            fill: #666;
        }

        .axis-label {
            font-size: 11px;
            fill: #666;
        }

        .legend {
            font-size: 12px;
            fill: #666;
        }

        .tooltip {
            position: absolute;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.2s;
            transform: translate(10px, -50%);
            z-index: 100;
        }

        .tooltip-date {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .tooltip-xp {
            color: #eee;
        }
    </style>
</head>

<body>
    <div class="chart-title">Your XP Progression Over Time</div>
    <div class="chart-container">
        <svg id="xpChart" viewBox="0 0 800 400">
            <!-- Chart elements will be added here -->
        </svg>
        <div class="tooltip" id="tooltip">
            <div class="tooltip-date" id="tooltip-date"></div>
            <div class="tooltip-xp" id="tooltip-xp"></div>
        </div>
    </div>

    <script>
        // Your data
        const xpData = [
            { date: new Date('2024-05-03T15:17:33+01:00'), xp: 5 },
            { date: new Date('2024-05-16T10:51:11+01:00'), xp: 11.125 },
            { date: new Date('2024-05-21T12:20:29+01:00'), xp: 17.25 },
            { date: new Date('2024-05-27T16:31:33+01:00'), xp: 23.375 },
            { date: new Date('2024-07-18T20:03:25+01:00'), xp: 29.5 },
            { date: new Date('2024-07-23T16:30:05+01:00'), xp: 38.7 },
            { date: new Date('2024-08-09T17:58:11+01:00'), xp: 47.9 },
            { date: new Date('2024-08-23T14:25:03+01:00'), xp: 57.1 },
            { date: new Date('2024-08-28T11:02:28+01:00'), xp: 57.15 },
            { date: new Date('2024-08-28T11:17:11+01:00'), xp: 57.25 },
            { date: new Date('2024-08-28T11:29:23+01:00'), xp: 57.4 },
            { date: new Date('2024-08-28T13:31:53+01:00'), xp: 57.6 },
            { date: new Date('2024-08-28T13:44:07+01:00'), xp: 57.85 },
            { date: new Date('2024-09-06T15:53:35+01:00'), xp: 67.05 },
            { date: new Date('2024-09-07T14:12:18+01:00'), xp: 73.175 },
            { date: new Date('2024-09-09T14:11:16+01:00'), xp: 97.675 },
            { date: new Date('2024-09-12T18:48:47+01:00'), xp: 109.925 },
            { date: new Date('2024-09-18T11:38:06+01:00'), xp: 119.925 },
            { date: new Date('2024-09-25T17:58:46+01:00'), xp: 132.175 },
            { date: new Date('2024-09-27T15:53:26+01:00'), xp: 137.175 },
            { date: new Date('2024-09-28T15:58:01+01:00'), xp: 147.175 },
            { date: new Date('2024-12-02T11:27:00+01:00'), xp: 181.55 },
            { date: new Date('2024-12-19T18:18:47+01:00'), xp: 257.8 },
            { date: new Date('2025-01-23T16:57:08+01:00'), xp: 327.8 },
            { date: new Date('2025-02-11T16:58:21+01:00'), xp: 474.8 },
            { date: new Date('2025-02-20T17:06:59+01:00'), xp: 523.8 },
            { date: new Date('2025-02-26T17:23:43Z'), xp: 572.8 },
            { date: new Date('2025-03-21T17:41:45Z'), xp: 676.3 }
        ];

        // Chart setup
        const svg = document.getElementById('xpChart');
        const tooltip = document.getElementById('tooltip');
        const tooltipDate = document.getElementById('tooltip-date');
        const tooltipXp = document.getElementById('tooltip-xp');
        const chartContainer = document.querySelector('.chart-container');

        const width = 800;
        const height = 400;
        const margin = { top: 30, right: 40, bottom: 50, left: 60 };
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        // Create chart group
        const chartGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        chartGroup.setAttribute('transform', `translate(${margin.left}, ${margin.top})`);
        svg.appendChild(chartGroup);

        // Calculate scales
        const xScale = (date) => {
            const dateExtent = [xpData[0].date, xpData[xpData.length - 1].date];
            return ((date - dateExtent[0]) / (dateExtent[1] - dateExtent[0])) * chartWidth;
        };

        const yScale = (xp) => {
            const maxXp = Math.max(...xpData.map(d => d.xp));
            return chartHeight - (xp / maxXp) * chartHeight;
        };

        // Function to position tooltip relative to point
        function positionTooltip(pointX, pointY) {
            // Get SVG dimensions relative to viewport
            const svgRect = svg.getBoundingClientRect();
            const containerRect = chartContainer.getBoundingClientRect();

            // Calculate scale factor based on current viewBox rendering
            const scaleX = svgRect.width / width;
            const scaleY = svgRect.height / height;

            // Calculate actual pixel position of the point
            const pixelX = (margin.left + pointX) * scaleX;
            const pixelY = (margin.top + pointY) * scaleY;

            // Position tooltip relative to chart container
            tooltip.style.left = `${pixelX}px`;
            tooltip.style.top = `${pixelY}px`;
        }

        // Draw area fill
        const areaPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        let areaData = xpData.map((d, i) => {
            const x = xScale(d.date);
            const y = yScale(d.xp);
            return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
        }).join(' ');
        areaData += ` L ${xScale(xpData[xpData.length - 1].date)} ${chartHeight} L ${xScale(xpData[0].date)} ${chartHeight} Z`;
        areaPath.setAttribute('d', areaData);
        areaPath.setAttribute('class', 'area-fill');
        chartGroup.appendChild(areaPath);

        // Draw trend line
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        let pathData = xpData.map((d, i) => {
            const x = xScale(d.date);
            const y = yScale(d.xp);
            return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
        }).join(' ');
        path.setAttribute('d', pathData);
        path.setAttribute('class', 'trend-line');
        chartGroup.appendChild(path);

        // Draw data points with hover effects
        xpData.forEach(d => {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            const x = xScale(d.date);
            const y = yScale(d.xp);

            circle.setAttribute('cx', x);
            circle.setAttribute('cy', y);
            circle.setAttribute('r', 3);
            circle.setAttribute('class', 'data-point');

            // Format date as "MMM DD, YYYY" (e.g., "Jan 23, 2025")
            const formattedDate = d.date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            // Format XP with 2 decimal places
            const formattedXp = d.xp.toFixed(2);

            circle.addEventListener('mouseover', () => {
                // Update tooltip content
                tooltipDate.textContent = formattedDate;
                tooltipXp.textContent = `XP: ${formattedXp}`;

                // Position tooltip relative to point
                positionTooltip(x, y);

                // Show tooltip
                tooltip.style.opacity = 1;

                // Enlarge point
                circle.setAttribute('r', 5);
            });

            circle.addEventListener('mouseout', () => {
                tooltip.style.opacity = 0;
                circle.setAttribute('r', 3);
            });

            // Update tooltip position when window resizes while hovering
            circle.addEventListener('mousemove', () => {
                positionTooltip(x, y);
            });

            chartGroup.appendChild(circle);
        });

        // Redraw tooltip position on resize
        window.addEventListener('resize', () => {
            if (tooltip.style.opacity === '1') {
                const activePoint = document.querySelector('.data-point:hover');
                if (activePoint) {
                    const x = parseFloat(activePoint.getAttribute('cx'));
                    const y = parseFloat(activePoint.getAttribute('cy'));
                    positionTooltip(x, y);
                }
            }
        });

        // Draw axes
        const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        xAxis.setAttribute('x1', 0);
        xAxis.setAttribute('y1', chartHeight);
        xAxis.setAttribute('x2', chartWidth);
        xAxis.setAttribute('y2', chartHeight);
        xAxis.setAttribute('class', 'axis');
        chartGroup.appendChild(xAxis);

        const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        yAxis.setAttribute('x1', 0);
        yAxis.setAttribute('y1', 0);
        yAxis.setAttribute('x2', 0);
        yAxis.setAttribute('y2', chartHeight);
        yAxis.setAttribute('class', 'axis');
        chartGroup.appendChild(yAxis);

        // Add X-axis labels (month abbreviations without spaces)
        const monthTicks = 8;
        for (let i = 0; i <= monthTicks; i++) {
            const date = new Date(
                xpData[0].date.getTime() +
                (i / monthTicks) * (xpData[xpData.length - 1].date - xpData[0].date)
            );

            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', xScale(date));
            label.setAttribute('y', chartHeight + 15);
            label.setAttribute('class', 'tick-text');
            label.setAttribute('text-anchor', 'middle');
            label.textContent = date.toLocaleDateString('en-US', {
                month: 'short',
                year: i % 2 === 0 ? '2-digit' : undefined
            }).replace(/ /g, '');
            chartGroup.appendChild(label);
        }

        // Add Y-axis labels
        const yTicks = 5;
        for (let i = 0; i <= yTicks; i++) {
            const xpValue = (i / yTicks) * Math.max(...xpData.map(d => d.xp));

            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', -10);
            label.setAttribute('y', yScale(xpValue) + 4);
            label.setAttribute('class', 'tick-text');
            label.setAttribute('text-anchor', 'end');
            label.textContent = Math.round(xpValue);
            chartGroup.appendChild(label);
        }

        // Add legend (duplicate "XP Earned" text)
        const legend1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        legend1.setAttribute('x', chartWidth - 10);
        legend1.setAttribute('y', -10);
        legend1.setAttribute('class', 'legend');
        legend1.setAttribute('text-anchor', 'end');
        legend1.textContent = 'XP Earned';
        chartGroup.appendChild(legend1);

        // const legend2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        // legend2.setAttribute('x', chartWidth - 10);
        // legend2.setAttribute('y', -25);
        // legend2.setAttribute('class', 'legend');
        // legend2.setAttribute('text-anchor', 'end');
        // legend2.textContent = 'XP Earned';
        // chartGroup.appendChild(legend2);
    </script>
</body>

</html>


<!-- <svg id="xp-graph" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet" width="100%">
    <line x1="50" y1="350" x2="700" y2="350" stroke="black" stroke-width="2"/>  X-awxis -->
<!-- <line x1="50" y1="350" x2="50" y2="10" stroke="black" stroke-width="2"/> Y-axis -->

<!-- <text x="300" y="390" text-anchor="middle">X-axis</text> -->
<!-- <text x="20" y="200" text-anchor="middle" transform="rotate(-90, 20, 200)">Y-axis</text> -->

<!-- الأعمدة ستضاف هنا عبر JavaScript -->
<!-- </svg> -->